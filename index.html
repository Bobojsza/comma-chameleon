<!DOCTYPE html>
<html>
  <head>
    <title>Untitled.csv</title>
    <script>
    window.$ = window.jQuery = require('./bower_components/jquery/dist/jquery.js');
    </script>
    <link rel="stylesheet" href="bower_components/handsontable/dist/handsontable.full.css" />
    <script src="bower_components/handsontable/dist/handsontable.full.js"></script>
    <script src="bower_components/jquery-csv/src/jquery.csv.min.js"></script>
    <style type="text/css">
      body, html {
        margin: 0;
        padding: 0;
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      }
    </style>
  </head>
  <body>
    <div id="editor"></div>
    <script>
    var ipc = require('ipc');
    var fs = require('fs');

    var container = document.getElementById("editor");
    var hot = new Handsontable(container, {
      colHeaders: true,
      rowHeaders: true,
      columnSorting: true,
      contextMenu: false
    });

    var remote = require('remote');
    var Menu = remote.require('menu');
    var MenuItem = remote.require('menu-item');

    var menu = new Menu();

    var rowAbove = new MenuItem({
      label: 'Insert row above',
      click: function() {
        hot.alter('insert_row', hot.getSelected()[0] - 1)
      }
    })

    var rowBelow = new MenuItem({
      label: 'Insert row below',
      click: function() {
        hot.alter('insert_row', hot.getSelected()[0] + 1)
      }
    })

    var columnLeft = new MenuItem({
      label: 'Insert column left',
      click: function() {
        hot.alter('insert_col', hot.getSelected()[1] - 1)
      }
    })

    var columnRight = new MenuItem({
      label: 'Insert column right',
      click: function() {
        hot.alter('insert_col', hot.getSelected()[1] + 1)
      }
    })

    var removeRow = new MenuItem({
      label: 'Remove entire row',
      click: function() {
        hot.alter('remove_row', hot.getSelected()[0])
      }
    })

    var removeCol = new MenuItem({
      label: 'Remove entire column',
      click: function() {
        hot.alter('remove_row', hot.getSelected()[1])
      }
    })

    menu.append(rowAbove);
    menu.append(rowBelow);
    menu.append(new MenuItem({ type: 'separator' }));
    menu.append(columnLeft);
    menu.append(columnRight);
    menu.append(new MenuItem({ type: 'separator' }));
    menu.append(removeRow);
    menu.append(removeCol);

    window.addEventListener('contextmenu', function (e) {
      e.preventDefault();
      if (hot.getSelected()[0] == 0) {
        rowAbove.enabled = false
      }
      if (hot.getSelected()[1] == 0) {
        columnLeft.enabled = false
      }
      menu.popup(remote.getCurrentWindow());
      rowAbove.enabled = true
      columnLeft.enabled = true
    }, false);

    ipc.on('loadData', function(data) {
      csv = $.csv.toArrays(data);
      hot.loadData(csv);
    });

    ipc.on('saveData', function(fileName) {
      data = hot.getData().map(function(d) { return d.join(",") }).join("\n")
      fs.writeFile(fileName, data, function (err) {
      });
      document.title = fileName;
    });

    </script>
  </body>
</html>
